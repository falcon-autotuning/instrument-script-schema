{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://falcon. io/schemas/instrument-api.json",
  "title": "Instrument API Definition",
  "description": "Schema for defining a single instrument's communication API",
  "type": "object",
  "required": [
    "api_version",
    "instrument",
    "protocol",
    "commands"
  ],
  "properties": {
    "api_version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
      "description": "**API Version** (required)\n\nSemantic version string (e.g., `1.0.0`)\n\nDefines the instrument API schema version."
    },
    "instrument": {
      "type": "object",
      "required": [
        "vendor",
        "model",
        "identifier"
      ],
      "description": "**Instrument Configuration** (required)\n\nDefines the physical instrument details including vendor, model, and identifier.",
      "properties": {
        "vendor": {
          "type": "string",
          "description": "**Vendor Name** (required)\n\nManufacturer of the instrument (e.g., `Keysight`, `Rohde & Schwarz`)."
        },
        "model": {
          "type": "string",
          "description": "**Model Number** (required)\n\nSpecific model identifier (e.g., `DSO9254A`, `RTM3004`)."
        },
        "identifier": {
          "type": "string",
          "pattern": "^[A-Z][A-Z0-9_]*$",
          "description": "**Unique Identifier** (required)\n\nA unique name for this instrument instance (e.g., `SCOPE_1`, `GPI`)."
        },
        "desc": {
          "type": "string",
          "description": "**Description** (optional)\n\nHuman-readable description of the instrument."
        }
      },
      "additionalProperties": false
    },
    "protocol": {
      "type": "object",
      "required": [
        "type"
      ],
      "description": "**Protocol Configuration** (required)\n\nDefines how to communicate with the instrument.",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "VISA",
            "Custom"
          ],
          "description": "**Protocol Type** (required)\n\nCommunication protocol:  `VISA`, `CUSTOM`."
        }
      },
      "additionalProperties": false
    },
    "commands": {
      "type": "object",
      "description": "**Commands** (required)\n\nInstrument command definitions mapping command names to their implementations.",
      "patternProperties": {
        "^[A-Z][A-Z0-9_]*$": {
          "$ref": "#/definitions/command"
        }
      },
      "additionalProperties": false
    }
  },
  "definitions": {
    "command": {
      "type": "object",
      "required": [
        "template",
        "parameters",
        "query"
      ],
      "properties": {
        "template": {
          "type": "string",
          "description": "**Template** (required)\n\nCommand template with {param} placeholders (e.g., 'SOUR{channel}: VOLT {voltage}')"
        },
        "description": {
          "type": "string",
          "description": "**Description** (optional)\n\nHuman-readable description of what this command does"
        },
        "parameters": {
          "type": "array",
          "description": "**Parameters** (required)\n\nOrdered list of parameters for this command",
          "items": {
            "$ref": "#/definitions/parameter"
          }
        },
        "returns": {
          "type": "string",
          "enum": [
            "void",
            "int",
            "float",
            "string",
            "bool",
            "array<float>",
            "array<int>"
          ],
          "default": "void",
          "description": "**Returns** (Optional)\n\nReturn type of the command. Can be int, float, string, bool, array<float>, array<int>, or void (no return)."
        },
        "query": {
          "type": "boolean",
          "default": false,
          "description": "**Query** (Required)\n\nWhether this is a query command (expects response)"
        }
      },
      "additionalProperties": false
    },
    "parameter": {
      "type": "object",
      "required": [
        "name",
        "type"
      ],
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9_]*$",
          "description": "**Name** (Required)\n\nParameter name (lowercase with underscores)"
        },
        "type": {
          "type": "string",
          "enum": [
            "int",
            "float",
            "string",
            "bool"
          ],
          "description": "**Type** (Required)\n\nParameter data type. Supported types: `int`, `float`, `string`, `bool`."
        },
        "description": {
          "type": "string",
          "description": "**Description** (Optional)\n\nHuman-readable description of the parameter"
        },
        "precision": {
          "type": "number",
          "minimum": 0,
          "description": "**Precision** (Optional)\n\nFloating point precision (for float types), defines precision to what minimum float"
        },
        "min": {
          "type": "number",
          "description": "**Min** (Optional)\n\nMinimum allowed value for this parameter"
        },
        "max": {
          "type": "number",
          "description": "**Max** (Optional)\n\nMaximum allowed value for this parameter"
        },
        "default": {
          "description": "Default value if not provided"
        },
        "unit": {
          "type": "string",
          "description": "**Unit** (Optional)\n\nPhysical unit (e.g., 'V', 'Hz', 's')"
        }
      },
      "additionalProperties": false
    }
  }
}
